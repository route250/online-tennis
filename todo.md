# TODO: 対戦型テニスゲーム 開発計画（サーバ中心設計）

## 概要（更新）
中央サーバ（Node.js + Express + WebSocket）を中継・権威ソースとして採用する。サーバはロビー管理とマッチメイキング、ゲームシミュレーション（簡易物理・GAME_STATE配信）を担当。ブラウザはUI・入力送信・描画を担当する。

## マイルストーン（サーバ中心）
- M1 (1日): プロジェクト初期化（既存ファイル整理）と spec のサーバ中心化（完了）
- M2 (1日): 最小サーバ実装（Express + ws）＋静的配信（/ws エンドポイント）
- M3 (2日): 接続/ロビー管理（CONNECT/JOIN_LOBBY/HEARTBEAT/PARTICIPANTS）
- M4 (2日): マッチング（INVITE/INVITE_RESPONSE/ROOM 作成）
- M5 (3日): ゲームシミュレーション（サーバ権威で物理、GAME_STATE 20Hz）
- M6 (2日): クライアントの WebSocket 対応（JOIN/INPUT 送信、GAME_STATE 受信で補間）
- M7 (1日): テスト・バグ修正・ドキュメント更新

合計: 約12日（個人開発の目安）

## タスク一覧（チェックリスト）
- [x] spec.md をサーバ中心設計へ更新
- [x] todo.md をサーバ中心に更新
- [x] tickets.md をサーバ中心に更新（変更履歴追記）
- [x] サーバ実装（Express + ws）
- [x] クライアントを WebSocket 対応に修正（src/app.js）
- [x] スコアボードをDOM分離（右側パネル）
- [x] ミラー描画（招待側は自分が下）
- [x] サーブ待ち中にボールがパドル追随
- [x] サーブ/返球でパドル速度を反映
- [x] 物理のすり抜け対策（スイープ判定）
- [x] UI刷新（黒基調・コートライン）、パドル幅を80へ
- [x] ドキュメント更新（README, spec, tickets, todo）
- [ ] ルーム/マッチングの結合テスト（2端末以上）
- [ ] ゲーム同期テスト（ラグ・パケットロス想定の簡易試験）

### 優先タスク（短期）
- [ ] サーバ最小実装（/, /ws, 接続ハンドリング） — M2
- [ ] ロビー配信（PARTICIPANTS イベント）とクライアント接続確認 — M3
- [ ] INVITE フローのサーバ中継実装 — M4
- [ ] サーバでの簡易物理ループと GAME_STATE 送信 — M5
- [ ] クライアントでの受信表示と入力送信（INPUT） — M6

## テスト項目（優先）
- WebSocket 接続で参加者がサーバに表示される
- INVITE→承諾でサーバがルームを作成し通知する
- サーバから定期的に GAME_STATE が届き、クライアントが描画する
- 切断・再接続でロビー状態が更新される

## リスクと対策（簡易）
- ネットワーク遅延 → サーバ権威 + クライアント補間で軽減
- 同一端末で複数タブ検証 → セッションIDで区別
- ファイアウォールやポート制限 → ポートを変更可能にしドキュメントに記載

## 開発環境メモ
- Node.js（推奨 18+）
- 主要パッケージ: express, ws
- 起動例:
  - サーバ: `node server/index.js`（`PORT` でポート指定可）
  - クライアント: 同一サーバから配信（`http://localhost:PORT`）にアクセス
