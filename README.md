# 対戦型テニスゲーム（WebSocket・サーバ権威）

黒基調のUIとテニスコート風のフィールドで遊べる、LAN内対戦用のテニスゲーム・プロトタイプです。詳しい仕様・プロトコルは `spec.md` を参照してください。

---

## 起動方法

依存のインストールとサーバ起動（サーバ起動はこのスクリプトのみ記載）:

```bash
npm install
bin/start-server.sh           # 既定ポート: 3000
bin/start-server.sh -p 4000   # ポートを指定
PORT=8080 bin/start-server.sh # 環境変数で指定も可
```

---

## ルールと遊び方

- 開き方: PC はブラウザで `http://<サーバIPまたはホスト>:<ポート>` を開きます（例: `http://localhost:3000`）。ロビー画面にサーバURLとQRコードが表示されるので、同じLANのスマホはQRを読み取るだけで簡単に参加できます。
- ロビー → ゲーム開始:
  - ユーザ名を入力してロビーに入室（入室後はユーザ名バッジと「退出」ボタンが表示されます）。
  - 参加者リストから相手の「対戦申し込み」を押す → 相手が承諾すると自動でゲームを開始します。
- 操作とルール:
  - 操作: 自分のパドルを左右にドラッグ（スマホはタッチで左右にスワイプ）。
  - サーブ: サーブ側プレイヤーが「指（またはマウス）を離した瞬間」にサーブします。サーブ待ち中はボールがサーブ側パドルに追随し、画面中央に「xxxのサーブです。」と表示されます。サーブ側がパドルを動かすと表示は消え、スコアは小さく表示されます。
  - 得点: ボールが相手側（自分から見て反対側）のエンドラインを越えると1点。点を取った側が次のサーブ権を得ます。
  - 勝利条件: 先取7点・2点差で勝利（最大11点で決着）。

---

## 仕様ドキュメント

- プロトコル・画面仕様・モバイル配慮・エンドポイント: `spec.md`

---

## フォルダ構成

- `client/index.html` — ロビー＋ゲーム画面（UIシェル）
- `client/app.js` — クライアントロジック（WebSocket、描画、入力）
- `client/styles.css` — クライアントのスタイル
- `server/index.js` — サーバ（Express + ws）/ WebSocketは`/ws`で待受。静的配信は `client/`
- `tests/` — 診断・統合テスト
  - `tests/test_lobby.js` — ロビー疎通のスモーク
  - `tests/test_integration.js` — 2クライアント統合テスト
- `logs/` — ローカルログ出力先（任意）。リポジトリからは除外
- `spec.md` — 設計概要とメッセージ仕様
- `tickets.md` — 詳細チケット/計画
- `todo.md` — タスク一覧

---

## 注意点

- 本プロジェクトはLAN前提のプロトタイプです（公開運用は非推奨）。詳細は `spec.md` を参照。
